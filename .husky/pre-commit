#!/bin/sh

echo "=== Pre-commit 검증 시작 ==="

# 1. TypeScript 타입 체크 (워닝 = 에러)
echo "[1/3] TypeScript 타입 체크..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo "TypeScript 타입 에러가 있습니다. 커밋이 중단됩니다."
  exit 1
fi

# 2. ESLint 검사 (워닝 0개 허용)
echo "[2/3] ESLint 검사..."
npx eslint --max-warnings 0 .
if [ $? -ne 0 ]; then
  echo "ESLint 에러 또는 워닝이 있습니다. 커밋이 중단됩니다."
  exit 1
fi

# 3. 테스트 + 커버리지 100% 검증
echo "[3/3] 테스트 실행 (커버리지 100% 필수)..."
npx vitest run --coverage
if [ $? -ne 0 ]; then
  echo "테스트 실패 또는 커버리지 100% 미달입니다. 커밋이 중단됩니다."
  exit 1
fi

echo "=== 모든 검증 통과! 커밋을 진행합니다. ==="
